# Name of your application. Used to uniquely configure containers.
service: zelusottomayor_portfolio

# Name of the container image.
image: zelusottomayor/zelusottomayor_portfolio

# Deploy to these servers.
servers:
  web:
    hosts:
      - 143.110.169.251
    # Resource limits to prevent runaway processes from overwhelming droplet
    options:
      cpus: "0.80"      # Increased after removing Solid Queue
      memory: "1400m"    # Increased to 1.4GB after removing background jobs
      memory-swap: "1800m"

proxy:
  ssl: true

  hosts: 
    - zelusottomayor.com
    - www.zelusottomayor.com
  app_port: 4000
  healthcheck:
    path: /up
    interval: 3
    timeout: 3

boot:
  limit: 30 # seconds to wait for container to be ready

registry:
  username: zelusottomayor

  password:
    - KAMAL_REGISTRY_PASSWORD

env:
  secret:
    - RAILS_MASTER_KEY
  clear:
    RAILS_MAX_THREADS: "5"
    WEB_CONCURRENCY: "0"
    PORT: "4000"
    MIXPANEL_TOKEN: "735ce9cb42f6ffe106ccc0bc16e565ac"

aliases:
  console: app exec --interactive --reuse "bin/rails console"
  shell: app exec --interactive --reuse "bash"
  logs: app logs -f
  dbc: app exec --interactive --reuse "bin/rails dbconsole"

volumes:
  - "zelusottomayor_portfolio_storage:/rails/storage"

asset_path: /rails/public/assets

builder:
  arch: amd64
  