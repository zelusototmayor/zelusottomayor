<% content_for :title, "#{@case_study.name} - #{@case_study.product? ? 'Product' : 'Case Study'} - Ze Lu Sottomayor" %>
<% content_for :meta_description, @case_study.tagline || "See how I helped #{@case_study.client_name} achieve their goals." %>

<div class="case-study-hero case-study-hero--condensed">
  <div class="container">
    <div class="case-study-breadcrumb">
      <%= link_to "← Back to work", work_path, class: "breadcrumb-link" %>
    </div>

    <div class="case-study-hero-content<%= ' case-study-hero-content--with-workflow' if @case_study.has_workflow? %>">
      <div class="case-study-hero-main">
        <div class="case-study-type-badge">
          <%= @case_study.has_admin_panel? || @case_study.has_workflow? ? "Automation" : @case_study.client_type.titleize %>
        </div>

        <h1 class="page-hero-title case-study-hero-title text-reveal"><%= @case_study.name %></h1>

        <% if @case_study.tagline.present? %>
          <p class="case-study-hero-tagline text-reveal"><%= @case_study.tagline %></p>
        <% end %>

        <% if @case_study.key_metrics.any? %>
          <div class="case-study-hero-metrics">
            <% @case_study.key_metrics.each do |metric| %>
              <span class="hero-metric-pill"><%= metric %></span>
            <% end %>
          </div>
        <% end %>

        <div class="case-study-hero-actions">
          <% if @case_study.has_admin_panel? %>
            <%= link_to @case_study.admin_panel_url, target: "_blank", rel: "noopener", class: "cta-button cta-button--primary cta-button--large" do %>
              <span>View Admin Panel</span>
              <span class="button-arrow">→</span>
            <% end %>
          <% elsif @case_study.link.present? %>
            <%= link_to @case_study.link, target: "_blank", rel: "noopener", class: "cta-button cta-button--primary cta-button--large" do %>
              <span>View Live Project</span>
              <span class="button-arrow">→</span>
            <% end %>
          <% elsif @case_study.product? %>
            <span class="cta-button cta-button--secondary cta-button--large cta-button--disabled">
              <span>Admin Panel Coming Soon</span>
            </span>
          <% end %>

          <% if @case_study.slug == "content-factory" %>
            <%= link_to "https://www.instagram.com/the_becoming_app/", target: "_blank", rel: "noopener", class: "cta-button cta-button--text cta-button--small" do %>
              <span>View Instagram Page</span>
              <span class="button-arrow">→</span>
            <% end %>
          <% end %>
        </div>
      </div>

      <% if @case_study.has_workflow? %>
        <div class="case-study-hero-workflow">
          <h3 class="case-study-hero-workflow-title">How It Works</h3>
          <%= render 'shared/workflow_pipeline_compact', steps: @case_study.workflow %>
        </div>
      <% elsif @case_study.hero_image.present? %>
        <div class="case-study-hero-visual">
          <%= image_tag @case_study.hero_image, alt: @case_study.name %>
        </div>
      <% end %>
    </div>
  </div>
</div>

<section class="case-study-content section-padding">
  <div class="container container--narrow">
    <% if @case_study.problem.present? %>
      <div class="case-study-section">
        <h2 class="case-study-section-title">The Challenge</h2>
        <%= simple_format @case_study.problem, class: "case-study-text" %>
      </div>
    <% end %>

    <% if @case_study.approach.present? %>
      <div class="case-study-section">
        <h2 class="case-study-section-title">The Solution</h2>
        <%= simple_format @case_study.approach, class: "case-study-text" %>
      </div>
    <% end %>

    <% if @case_study.results.present? %>
      <div class="case-study-section">
        <h2 class="case-study-section-title">The Results</h2>
        <%= simple_format @case_study.results, class: "case-study-text" %>
      </div>
    <% end %>
  </div>
</section>

<% if @related_studies.present? && @related_studies.any? %>
  <section class="related-studies section-padding bg-gradient">
    <div class="container">
      <h2 class="section-title">More like this</h2>
      <div class="case-studies-grid">
        <% @related_studies.each do |case_study| %>
          <%= render 'shared/case_study_card', case_study: case_study %>
        <% end %>
      </div>
    </div>
  </section>
<% end %>

<% if @case_study.has_admin_panel? || @case_study.has_workflow? %>
  <%= render 'shared/cta_section',
      headline: "Want to build something like this?",
      subheadline: "Let's discuss how automation can transform your workflow.",
      button_text: "Book a discovery call",
      button_url: book_call_path,
      secondary_text: "See all work",
      secondary_url: work_path %>
<% else %>
  <%= render 'shared/cta_section',
      headline: "Want similar results?",
      subheadline: "Let's talk about how I can help with your project.",
      button_text: "Book a discovery call",
      button_url: book_call_path,
      secondary_text: "See all work",
      secondary_url: work_path %>
<% end %>
